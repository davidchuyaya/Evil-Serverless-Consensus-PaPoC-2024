% Latex Template - Distributed Systems Group - UC Berkeley 2020


% Package list. Please add packages alphabetically with a quick note
% of what they do
% ================================================
\usepackage[ruled,linesnumbered]{algorithm2e}
\usepackage[noend]{algpseudocode}
\usepackage{amsthm}
\usepackage{amsmath}
% \usepackage{amssymb} % Clashes with definition in acmart.cls. See https://tex.stackexchange.com/questions/564490/command-bbbk-already-defined-ol-bbbk-mathordamsb7c-when-i-try-t
\usepackage{array}
% \usepackage{balance}
% \usepackage{blindtext}
% \usepackage[font={it,small}]{caption}
% \usepackage{changepage}
\usepackage{color}
\usepackage{comment} % enables easy commenting of lines of text
\usepackage{enumitem} %adds an easy way to customise margins for enums and itemize, incompatible with savetrees[moderate]
\usepackage{etoolbox}
\usepackage[export]{adjustbox}
\usepackage{filecontents}
\usepackage{ifthen}
\usepackage[utf8]{inputenc}
\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template
\usepackage{listings}
\usepackage{hyperref}
\usepackage{cleveref} % can reference multiple things with \cref{a,b,c}
\usepackage{makecell} % easy way to break lines latex
\usepackage{mdframed}
\usepackage{multirow}
\usepackage{parskip}
\usepackage{pifont}% http://ctan.org/pkg/pifont
\usepackage{pseudocode}
\usepackage[group-separator={,}]{siunitx}
% \usepackage[compact]{titlesec} % David: This messes with the font of the sections.
\usepackage{soul}
\usepackage{subfloat}
\usepackage{subcaption}
% \usepackage{subfigure} % David: Outdated and will produce error: https://www.overleaf.com/learn/latex/Errors/Missing_number%2C_treated_as_zero
\usepackage{textcomp}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usepackage{wrapfig}
% \usepackage{times} % David: Don't want Times New Roman as the default font.
\usepackage{url}
\usepackage{xspace}
\usepackage{xcolor}
\usepackage{xurl}
% PDF Configuration
% ================================================
% Format PDF
\hypersetup{breaklinks=true, pdfauthor={Chu, David}, pdftitle={Safety of Scaling Byzantine Protocols},
  colorlinks=true,
  citecolor=blue,
  urlcolor=blue,
  linkcolor=blue,
  pdfborder={0 0 0}}
\sloppy
\frenchspacing
\makeatletter
\patchcmd{\ttlh@hang}{\parindent\z@}{\parindent\z@\leavevmode}{}{}
\patchcmd{\ttlh@hang}{\noindent}{}{}{}
\patchcmd{\maketitle}
{\@maketitle}
{\@maketitle\vspace{-1em}}% change the value as needed
{}
{}
\makeatother
% ================================================

% Template Options
% ================================================
% If set, ensures that all comments are removed
\newboolean{publicversion}
% If set, ensures that is appropriately referred to as TR. IMPORTANT: Also change the documentclass at the top of main.tex
\newboolean{tr}
% If set, ensures that appropriate elements are anonymised
\newboolean{optanon}
% If set, activates space saving tricks
\newboolean{compress}
% If set, activates Usenix formatting
\newboolean{usenix}
% If set, activates ACM formatting
\newboolean{acm}

% Default values
\setboolean{tr}{false}
\setboolean{publicversion}{false}
\setboolean{compress}{false}
\setboolean{optanon}{false}
\setboolean{usenix}{false}
\setboolean{acm}{true}
% ================================================

% Conference Style 
% ================================================
\ifthenelse{\boolean{usenix}}{
    % Makes sure that the usenix package is regularly updated
    \usepackage{usenix-2020-09}
    % These packages are not compatible with ACM
    \usepackage[numbers,sort&compress,square]{natbib}
    \usepackage[normalem]{ulem} % Defines strikeout Breaks bibtex
}{
    \ifthenelse{\boolean{acm}} {
    
    }{}
}
% ================================================

% Space-saving Options 
% ================================================
\ifthenelse{\boolean{compress}}{
  %\setlength{\tabcolsep}{0.25in}
  \setlist[itemize]{leftmargin=*}
  \setlist[enumerate]{leftmargin=*}
  \setlist{itemsep=0pt,parsep=0pt}             % more compact lists
  \usepackage[subtle,wordspacing=normal]{savetrees} % Saves space
  \setlength{\parskip}{2pt plus 1mm minus 1mm} %No line skip
  \setlength{\parindent}{5pt} % Default is 15pt. 
  \setlength\abovedisplayskip{2pt plus 2pt minus 2pt}% minimises space above display maths
  \setlength\belowdisplayskip{2pt plus 2pt minus 2pt}% minimises space below displaymaths
  \setlength{\abovecaptionskip}{1pt} % minimises space below caption
  \setlength{\belowcaptionskip}{1pt} % minimises space below caption
  \setlength\floatsep{2pt plus  0pt minus 0pt}
  \setlength\textfloatsep{3pt plus 0pt minus 0pt}
} 
{
}

% ================================================


% Commenting Options 
% ================================================
\definecolor{gold}{RGB}{218,165,32}
\definecolor{lightblue}{rgb}{0.6,1.0,0.6}
\definecolor{mint}{rgb}{0.24,0.71,0.54}

\definecolor{googleblue}{RGB}{66, 133, 244}

\ifthenelse{\boolean{publicversion}}{
  % Comments deactivated
  \newcommand{\grumbler}[2]{}
  \newcommand{\changebars}[2]{#2}
  \newcommand{\pagelimit}[1]{}
  \newcommand{\todo}[1]{}
  \newcommand{\}
  % User-specific grumblers
   \newcommand{\david}[1]{}
    \newcommand{\jmh}[1]{}
    \newcommand{\natacha}[1]{}
    \newcommand{\nc}[1]{}
    \newcommand{\heidi}[1]{}
    \newcommand{\kaushik}[1]{}
    \newcommand{\rithvik}[1]{}
    \newcommand{\conor}[1]{}
    \newcommand{\suyash}[1]{}
    \newcommand{\shadaj}[1]{}
    \newcommand{\fs}[1]{}
    \newcommand{\tiemo}[1]{}
    \newcommand{\chris}[1]{}
    \newcommand{\michael}[1]{}
    \newcommand{\accheng}[1]{}
} 
{
  \newcommand{\grumbler}[2]{{{\bf #1:} #2}}
  \newcommand{\pagelimit}[1]{{\hl{ #1 pages }}}
  \newcommand{\changebars}[2]{[{\em \color{gray} Old: #1}] [{\color{purple} New: #2}]}
  \newcommand{\todo}[1]{\hl{TODO: #1}}
  % User-specific grumblers
  \newcommand{\david}[1]{{\color{magenta}\grumbler{David}{#1}}}
    \newcommand{\jmh}[1]{{\color{cyan}\grumbler{Joe}{#1}}}
    \newcommand{\natacha}[1]{{\color{blue}\grumbler{Natacha}{#1}}}
    \newcommand{\nc}[1]{{\color{blue}\grumbler{Natacha}{#1}}}
    \newcommand{\heidi}[1]{{\color{gold}\grumbler{Heidi}{#1}}}
    \newcommand{\kaushik}[1]{{\color{red}\grumbler{Kaushik}{#1}}}
    \newcommand{\rithvik}[1]{{\color{orange}\grumbler{Rithvik}{#1}}}
    \newcommand{\conor}[1]{{\color{purple}\grumbler{Conor}{#1}}}
    \newcommand{\suyash}[1]{{\color{green}\grumbler{Suyash}{#1}}}
    \newcommand{\shadaj}[1]{{\color{yellow}\grumbler{Shadaj}{#1}}}
    \newcommand{\fs}[1]{{\color{teal}\grumbler{Florian}{#1}}}
    \newcommand{\tiemo}[1]{{\color{brown}\grumbler{Tiemo}{#1}}}
    \newcommand{\chris}[1]{{\color{mint}\grumbler{Chris}{#1}}}
    \newcommand{\michael}[1]{{\color{googleblue}\grumbler{Michael}{#1}}}
    \newcommand{\accheng}[1]{{\color{pink}\grumbler{Audrey}{#1}}}
}

% ================================================

% Anonymising options
% ================================================
 \ifthenelse{\boolean{optanon}}%
   {\newcommand{\anonAndNonAnon}[2]{#1}}%
   {\newcommand{\anonAndNonAnon}[2]{#2}}
% ================================================
 
% Technical Report Options
% ================================================
 \ifthenelse{\boolean{tr}}{
    \newcommand{\tr}[2]{#1}
}
{
    \newcommand{\tr}[2]{#2}
}
% ================================================
 

% Supplemental Commands 
% ===============================================
% Experiments
% Checkmarks
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%


% Enumeration
\newcommand{\one}{({\em i}\/)\xspace}
\newcommand{\two}{({\em ii}\/)\xspace}
\newcommand{\three}{({\em iii}\/)\xspace}
\newcommand{\four}{({\em iv}\/)\xspace}
\newcommand{\five}{({\em v}\/)\xspace}

% Symbols
\newcommand{\tinydag}{\textsuperscript{\dag}}
\newcommand{\tinyddag}{\textsuperscript{\ddag}}
\newcommand{\tinystar}{\textsuperscript{\S}}

% Table Formatting
% Define table new line
\newcommand{\tabincell}[2]{\begin{tabular}{@{}#1@{}}#2\end{tabular}}
%Align left single column
\newcommand{\alignleft}[1]{\multicolumn{1}{l}{#1}}
%Align right single column
\newcommand{\alignright}[1]{\multicolumn{1}{r}{#1}}
%Align center single column
\newcommand{\aligncenter}[1]{\multicolumn{1}{c}{#1}}


% Theorems
\newtheoremstyle{indented}
{1pt}   % ABOVESPACE
{1pt}   % BELOWSPACE
{\itshape}  % BODYFONT
{1pt}       % INDENT (empty value is the same as 0pt)
{\bfseries} % HEADFONT
{}         % HEADPUNCT
{2pt plus 1pt minus 1pt} % HEADSPACE
{}          % CUSTOM-HEAD-SPEC

\newtheoremstyle{noindent}
{2pt}   % ABOVESPACE
{2pt}   % BELOWSPACE
{\itshape}  % BODYFONT
{0pt}       % INDENT (empty value is the same as 0pt)
{\bfseries} % HEADFONT
{}         % HEADPUNCT
{2pt plus 1pt minus 1pt} % HEADSPACE
{}          % CUSTOM-HEAD-SPEC

\theoremstyle{plain}
\newtheorem{lemma}{Lemma}
\newtheorem{theorem}{Theorem}
\newtheorem{claim}{Claim}
\theoremstyle{noindent}
\newtheorem{lemma-noindent}{Lemma}
\newtheorem{theorem-noindent}{Theorem}
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

% Creates a pprof sketch environment
\newenvironment{sketch}{%
  \renewcommand{\proofname}{Proof sketch}\proof}{\endproof}

% Appendix
\addcontentsline{toc}{chapter}{Appendix}

% System names
% ================================================
\newcommand{\Rust}{\includegraphics[scale=0.015]{assets/rust.png}}
\newcommand{\sys}{\textsc{Auto-Whittaker}}
\newcommand{\DedalusVoting}{\Rust{}BaseVoting}
\newcommand{\DedalusTwoPC}{\Rust{}Base2PC}
\newcommand{\DedalusPaxos}{\Rust{}BasePaxos}
\newcommand{\AutoVoting}{\Rust{}ScalableVoting}
\newcommand{\AutoTwoPC}{\Rust{}Scalable2PC}
\newcommand{\AutoPaxos}{\Rust{}ScalablePaxos}
\newcommand{\ScalaPaxos}{BasePaxos}
\newcommand{\CompPaxos}{CompPaxos}
\newcommand{\DedalusCompPaxos}{\Rust{}CompPaxos}
\newcommand{\ourApproach}{\changebars{systematic}{rule-driven} rewrite}
\newcommand{\OurApproach}{\changebars{Systematic}{Rule-driven} rewrite}
\newcommand{\traditionalApproach}{\changebars{manual}{ad hoc} rewrite}
\newcommand{\TraditionalApproach}{\changebars{Manual}{Ad hoc} rewrite}

% Black & white printer-friendly colors from bpy.colors(10) in R
% ================================================
\definecolor{black}{HTML}{000000} % modified from 000033
\definecolor{navy}{HTML}{000099}
\definecolor{blue}{HTML}{0000FF}
\definecolor{purple}{HTML}{5000FF}
\definecolor{violet}{HTML}{9F0FF0}
\definecolor{pink}{HTML}{EF42BD}
\definecolor{red}{HTML}{FF758A}
\definecolor{orange}{HTML}{FFA857}
\definecolor{yellow}{HTML}{FFDB24}
% \definecolor{10}{HTML}{FFFF60} Light yellow, too light


% Listings for Dedalus
% ================================================
\lstdefinestyle{default}{
    basicstyle=\small\fontfamily{cmtt}\selectfont,
    float,
    breaklines=true,
    breakatwhitespace=true,
    breakindent=20pt,
    belowskip=-0.1\baselineskip,
    frame=single,
    framesep=0pt,
    numbers=left,
    columns=fullflexible,
    escapechar=|,
    numberstyle=\tiny,
}
\lstdefinelanguage{Dedalus}{
    style=default,
    morekeywords=[1]{hash, sign, leader, storageNodes, numNodes, client, verify, forward},
    keywordstyle=[1]\color{orange},
    morekeywords=[2]{delay},
    keywordstyle=[2]\color{pink},
    morekeywords=[3]{count, cert, seal, sum},
    keywordstyle=[3]\color{violet},
    morecomment=[l]{\#},
    commentstyle=\color{gray},
}
\lstdefinelanguage{Fact}{
    style=default,
    basicstyle=\tiny\fontfamily{lmss}\selectfont,
    morekeywords=[1]{hash, sign, leader, storageNodes, numNodes, client, verify, forward},
    keywordstyle=[1]\color{orange},
    morekeywords=[2]{delay},
    keywordstyle=[2]\color{pink},
    morekeywords=[3]{count, cert, seal, sum, max},
    keywordstyle=[3]\color{violet},
    morecomment=[l]{\#},
    commentstyle=\color{gray},
}
\newcommand{\ded}[1]{\mbox{\lstinline[language=Dedalus]{#1}}}
\newcommand{\fact}[1]{\mbox{\lstinline[language=Fact]{#1}}}
\definecolor{lightgray}{RGB}{240,240,240}
% Magic that lets us reference line numbers by \ref{lst:label-number}
\makeatletter
\lst@AddToHook{EveryPar}{
    \edef\@temp{\noexpand\label{\lst@label-\arabic{lstnumber}}}
    \@temp
}
\makeatother

% Tikz pictures
% ================================================
\usetikzlibrary{positioning, shapes.geometric, fit}